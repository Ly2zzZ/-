<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>
<body>
  <script src='./d3.v5.js'></script>
  <script>
    d3.csv('./data.csv').then(data => {
      let re = data.filter(item=>item._mt_message.indexOf('appVersion') !== -1);

      let verson = [];
      re = re.map(item => {
        item._mt_message = JSON.parse(item._mt_message);
        item._mt_message.dynamicMetrics = JSON.parse(item._mt_message.dynamicMetrics);
        verson.push(item._mt_message.dynamicMetrics.appVersion);
        return item;
      });

      verson = Array.from(new Set(verson));
      verson = verson.sort((a, b) => {
        let aa = a.slice(1).split('.');
        let bb = b.slice(1).split('.');
        if (+aa[0] > +bb[0]) {
          return -1;
        } else if(+aa[0] < +bb[0]) {
          return 1;
        }
        if (+aa[1] > +bb[1]) {
          return -1;
        } else if(+aa[1] < +bb[1]) {
          return 1;
        } 
        if (+aa[2] > +bb[2]) {
          return -1;
        } else if(+aa[2] < +bb[2]) {
          return 1;
        } 
        if (+aa[3] > +bb[3]) {
          return -1;
        } else if(+aa[3] < +bb[3]) {
          return 1;
        }

        return 0;
      })
      let latestVerson = verson.shift();

      re = re.filter(item => item._mt_message.dynamicMetrics.appVersion !== latestVerson);

      console.log(re);
    })
  </script>
</body>
</html>